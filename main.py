import yaylib
import random
import time
import os
from datetime import datetime

# 環境変数からアカウント情報を取得
account_list = os.getenv('YAY_ACCOUNTS', '').split(',')

# ログイン情報のリスト作成
accounts = []
for account in account_list:
    parts = account.split(':')
    if len(parts) == 2:
        accounts.append({'email': parts[0], 'password': parts[1]})

# 各時間帯の投稿リスト（1時間ごとに8個）
hourly_posts = {
        1: ["もう1時！？時間早すぎ…", "深夜のネットサーフィンが止まらない", "誰か電話しない？📞", "コンビニ行きたい🍫",
        "夜中のラーメンは最強🍜", "眠れない人いる〜？", "そろそろ寝ないと💦", "明日起きれるかな…"],
    2: ["深夜組集合〜！", "もうそろそろ寝ないと😪", "YouTube見てたらこんな時間😱", "小腹すいたなぁ…",
        "夜中に食べるお菓子は罪だけど美味い", "朝が来る前に寝るぞ！", "寝る前にストレッチしよ🧘‍♀️", "ラジオ聴いてる📻"],
    3: ["この時間起きてるのは少数派…？", "完全に夜更かししすぎた😂", "3時って一番眠くなる時間…", "もう寝なきゃ…",
        "夜の静けさって落ち着く🌙", "SNS見てたら時間溶けた😵", "そろそろ寝落ちしそう😴", "夜中に考え事しちゃう…"],
    4: ["おはようって言っていいのか微妙な時間", "早起き？それとも夜更かし？", "空が少し明るくなってきた🌅",
        "そろそろ朝の準備するか…", "こんな時間に起きてるの自分だけ？", "朝ごはん食べる人いる？", "眠すぎる…", "今日の予定考え中🤔"],
    5: ["朝が来た〜🌞", "完全に寝不足😂", "眠いけど頑張る💪", "そろそろ朝ごはん食べようかな？", 
        "早起きさんいる？", "今日も一日頑張ろう✨", "なんだかんだ夜更かししちゃった💦", "おはよう世界🌎"],
    6: ["おはよ〜！今日も頑張ろっ✨", "ねむい…あと5分寝たい🥱", "朝ごはんはパン派？ごはん派？🍞🍚", "顔洗ったら少しスッキリ！", 
        "もう少し布団にいたいなぁ…", "朝の空気って気持ちいい🌤", "今日の服どうしよ〜👗", "学校or仕事ファイト💪✨"],
    7: ["まだちょっと眠い…🥱", "朝ごはん食べた？🍳", "今日の天気どうかな？", "みんな何時に起きるタイプ？", 
        "朝の準備バタバタする💦", "通勤or通学中〜🚃", "コーヒー飲んで目覚まそ☕️", "今日も楽しい1日になりますように✨"],
    8: ["通勤中〜🚃", "電車混んでる…😵", "カフェでモーニングしてる☕️🍞", "学校or仕事ついた〜！", 
        "朝って時間経つの早いよね😵", "今日の予定なにかある？", "頑張りすぎずにね💖", "週末が待ち遠しい…！"],
    9: ["そろそろお腹すいてきたかも🍙", "仕事or授業中〜📖", "今日の天気いい感じ🌞", "朝のカフェって落ち着く☕️", 
        "集中しなきゃだけど眠い…", "適度に休憩も大事💡", "今日やることメモしよ📝", "お昼なに食べよ〜？"],
    10: ["ちょっと一息つこ☕️", "みんななにしてるの〜？", "そろそろお昼の時間近づいてきたね", "眠くて頭まわらない😂", 
         "集中モードに入ろうかな🔥", "カフェでお仕事or勉強中✍️", "音楽聞きながらリラックス🎶", "誰かと話したいな〜💬"],
    11: ["お昼ごはんどうしよ〜🍚", "ランチ何にしようか迷う🍜", "お昼休みまであとちょっと…", "外食しようかな？", 
         "誰か一緒にランチ行こ〜", "お昼に甘いもの食べたい🍰", "午後もがんばるぞ💪", "お昼寝したくなる時間😪"],
    12: ["ランチなう🍽", "お昼ごはん美味しい〜😋", "午後もがんばるぞー！", "ちょっと眠くなってきた…", 
         "ごはん食べたら元気出た✨", "みんな何食べた？", "デザート食べたい🍦", "午後の予定ある人〜？"],
    13: ["午後の仕事or授業スタート！💼", "ランチ後って眠くなるよね😪", "午後もがんばろ〜！", "コーヒー飲んで気合い入れよ☕️",
         "午後は何しようかな？", "会議めんどくさいなぁ💦", "休憩時間が待ち遠しい…", "ちょっと散歩しようかな🚶‍♂️"],
    14: ["まだお昼の眠気が抜けない😴", "そろそろおやつの時間🍩", "午後の仕事やる気スイッチどこ？", "学校or仕事終わった人いる？",
         "何か面白いことないかな〜", "音楽聞きながらリラックス🎧", "みんな午後は何してるの？", "ちょっと眠気覚ましにストレッチ！"],
    15: ["おやつタイム〜🍰", "あと少しで終業時間…", "カフェに寄りたいな☕️", "夕方の予定ある？", 
         "午後の授業or会議、がんばろう！", "今日のニュースチェック中📺", "そろそろ疲れてきた😵", "ちょっと仮眠しよっかな😴"],
    16: ["あと少しで仕事or授業終わる！💪", "夕方の空って綺麗だよね🌇", "今日の晩ごはん何にしよう？", "仕事帰りに寄り道したいな〜",
         "そろそろお家に帰る準備🏡", "疲れたけどあと少し！", "カフェでのんびり中☕", "お風呂入りたい〜🛀"],
    17: ["おつかれさま〜✨", "夕方のこの時間、好きかも🌆", "そろそろ帰ろう🚃", "夕飯の準備しないと🍳",
         "誰かとご飯行きたいな〜", "家に帰ったら即ゴロゴロしたい😆", "暗くなるの早くなったなぁ…", "まだ仕事の人、がんばれ💪"],
    18: ["夜ご飯の時間だ〜！🍚", "今日の夕飯はなににしよう", "仕事終わりのビール最高🍺", "晩ごはん何食べた？"],
    19: ["夜ご飯食べ終わった？", "この時間はYouTube見たくなる📱", "夜のカフェでのんびり中☕"],
    20: ["夜のリラックスタイム✨", "そろそろお風呂入ろうかな🛀", "寝る前のストレッチしよっかな🤸"],
    21: ["そろそろ寝る準備してる？", "今日の振り返り中📝", "お風呂上がりのアイス最高🍦"],
    22: ["寝る前のリラックスタイム🌙", "夜更かしする人〜？🙋", "今日も1日お疲れさま💖"],
    23: ["そろそろ寝ようかな😴", "夜って色々考えちゃうよね🤔"],
    24: ["こんな時間まで起きてる人いる？", "そろそろ寝る準備しよ〜"]
}

# 4回に1回、投稿の最後に付ける文章
dm_message = " だれかDMしませんか、。フォローもお願いします🙏🏻‎🤍"

# 指定された時間帯の投稿リストからランダムに4つ選ぶ
def get_time_based_posts():
    now = datetime.now().hour
    posts = random.sample(hourly_posts[now], 4) if now in hourly_posts else ["なにしてるの〜？💬", "ちょっとおしゃべりしたい💖"]

    # 4回に1回の確率でDM誘導を追加
    for i in range(len(posts)):
        if random.randint(1, 4) == 1:
            posts[i] += dm_message

    return posts

# ログイン処理
yay_clients = []

for account in accounts:
    try:
        client = yaylib.Client()
        client.login(account["email"], account["password"])
        yay_clients.append(client)
    except Exception as e:
        print(f"{account['email']} のログインに失敗: {e}")

# メインの投稿ループ
while True:
    try:
        client = random.choice(yay_clients)
        posts = get_time_based_posts()

        for post_content in posts:
            client.create_post(post_content)
            print(f'投稿しました: {post_content}')
            time.sleep(900)

    except yaylib.errors.HTTPError as e:
        if "429" in str(e):
            time.sleep(random.randint(600, 1800))
        else:
            break
