import yaylib
import random
import time
import os
from datetime import datetime, timedelta
import pytz

print("ğŸš€ ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹")

# æ—¥æœ¬æ™‚é–“ï¼ˆJSTï¼‰ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¨­å®š
jst = pytz.timezone('Asia/Tokyo')

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—ï¼ˆä¾‹: "email1:password1,email2:password2"ï¼‰
account_list = os.getenv('YAY_ACCOUNTS', '').split(',')

# ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãƒªã‚¹ãƒˆä½œæˆ
accounts = []
for account in account_list:
    parts = account.split(':')
    if len(parts) == 2:
        accounts.append({'email': parts[0], 'password': parts[1]})

print("å–å¾—ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±:", accounts)

# å„æ™‚é–“å¸¯ã®æŠ•ç¨¿å†…å®¹ï¼ˆ1æ™‚é–“ã”ã¨ã«8å€‹ã®å€™è£œï¼‰
# â€»å¿…è¦ã«å¿œã˜ã¦7ã€œ22æ™‚ã‚‚åŒæ§˜ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
post_texts = {
    1: ["ã‚‚ã†1æ™‚ï¼ï¼Ÿæ™‚é–“æ—©ã™ãâ€¦", "æ·±å¤œã®ãƒãƒƒãƒˆã‚µãƒ¼ãƒ•ã‚£ãƒ³ãŒæ­¢ã¾ã‚‰ãªã„", "èª°ã‹é›»è©±ã—ãªã„ï¼Ÿ", "ã‚³ãƒ³ãƒ“ãƒ‹è¡ŒããŸã„",
        "å¤œä¸­ã®ãƒ©ãƒ¼ãƒ¡ãƒ³ã¯æœ€å¼·", "çœ ã‚Œãªã„äººã„ã‚‹ã€œï¼Ÿ", "ãã‚ãã‚å¯ãªã„ã¨", "æ˜æ—¥èµ·ãã‚Œã‚‹ã‹ãªâ€¦"],
    2: ["æ·±å¤œçµ„é›†åˆã€œï¼", "ã‚‚ã†ãã‚ãã‚å¯ãªã„ã¨", "YouTubeè¦‹ã¦ãŸã‚‰ã“ã‚“ãªæ™‚é–“", "å°è…¹ã™ã„ãŸãªãâ€¦",
        "å¤œä¸­ã«é£Ÿã¹ã‚‹ãŠè“å­ã¯ç½ªã ã‘ã©ç¾å‘³ã„", "æœãŒæ¥ã‚‹å‰ã«å¯ã‚‹ãï¼", "å¯ã‚‹å‰ã«ã‚¹ãƒˆãƒ¬ãƒƒãƒã—ã‚ˆ", "ãƒ©ã‚¸ã‚ªè´ã„ã¦ã‚‹"],
    3: ["ã“ã®æ™‚é–“èµ·ãã¦ã‚‹ã®ã¯å°‘æ•°æ´¾â€¦ï¼Ÿ", "å®Œå…¨ã«å¤œæ›´ã‹ã—ã—ã™ããŸ", "3æ™‚ã£ã¦ä¸€ç•ªçœ ããªã‚‹æ™‚é–“â€¦", "ã‚‚ã†å¯ãªãã‚ƒâ€¦",
        "å¤œã®é™ã‘ã•ã£ã¦è½ã¡ç€ã", "SNSè¦‹ã¦ãŸã‚‰æ™‚é–“æº¶ã‘ãŸ", "ãã‚ãã‚å¯è½ã¡ã—ãã†", "å¤œä¸­ã«è€ƒãˆäº‹ã—ã¡ã‚ƒã†â€¦"],
    4: ["ãŠã¯ã‚ˆã†ã£ã¦è¨€ã£ã¦ã„ã„ã®ã‹å¾®å¦™ãªæ™‚é–“", "æ—©èµ·ãï¼Ÿãã‚Œã¨ã‚‚å¤œæ›´ã‹ã—ï¼Ÿ", "ç©ºãŒå°‘ã—æ˜ã‚‹ããªã£ã¦ããŸ",
        "ãã‚ãã‚æœã®æº–å‚™ã™ã‚‹ã‹â€¦", "ã“ã‚“ãªæ™‚é–“ã«èµ·ãã¦ã‚‹ã®è‡ªåˆ†ã ã‘ï¼Ÿ", "æœã”ã¯ã‚“é£Ÿã¹ã‚‹äººã„ã‚‹ï¼Ÿ", "çœ ã™ãã‚‹â€¦", "ä»Šæ—¥ã®äºˆå®šè€ƒãˆä¸­"],
    5: ["æœãŒæ¥ãŸã€œ", "å®Œå…¨ã«å¯ä¸è¶³", "çœ ã„ã‘ã©é ‘å¼µã‚‹", "ãã‚ãã‚æœã”ã¯ã‚“é£Ÿã¹ã‚ˆã†ã‹ãªï¼Ÿ", 
        "æ—©èµ·ãã•ã‚“ã„ã‚‹ï¼Ÿ", "ä»Šæ—¥ã‚‚ä¸€æ—¥é ‘å¼µã‚ã†", "ãªã‚“ã ã‹ã‚“ã å¤œæ›´ã‹ã—ã—ã¡ã‚ƒã£ãŸ", "ãŠã¯ã‚ˆã†ä¸–ç•Œ"],
    6: ["ãŠã¯ã‚ˆã€œï¼ä»Šæ—¥ã‚‚é ‘å¼µã‚ã£", "ã­ã‚€ã„â€¦ã‚ã¨5åˆ†å¯ãŸã„", "æœã”ã¯ã‚“ã¯ãƒ‘ãƒ³æ´¾ï¼Ÿã”ã¯ã‚“æ´¾ï¼Ÿ", "é¡”æ´—ã£ãŸã‚‰å°‘ã—ã‚¹ãƒƒã‚­ãƒªï¼", 
        "ã‚‚ã†å°‘ã—å¸ƒå›£ã«ã„ãŸã„ãªãâ€¦", "æœã®ç©ºæ°—ã£ã¦æ°—æŒã¡ã„ã„", "ä»Šæ—¥ã®æœã©ã†ã—ã‚ˆã€œ", "å­¦æ ¡orä»•äº‹ãƒ•ã‚¡ã‚¤ãƒˆğŸ”¥"],
    7: ["ã¾ã ã¡ã‚‡ã£ã¨çœ ã„â€¦", "æœã”ã¯ã‚“é£Ÿã¹ãŸï¼Ÿ", "ä»Šæ—¥ã®å¤©æ°—ã©ã†ã‹ãªï¼Ÿ", "ã¿ã‚“ãªä½•æ™‚ã«èµ·ãã‚‹ã‚¿ã‚¤ãƒ—ï¼Ÿ", 
        "æœã®æº–å‚™ãƒã‚¿ãƒã‚¿ã™ã‚‹", "é€šå‹¤ä¸­ã€œï½", "ã‚³ãƒ¼ãƒ’ãƒ¼é£²ã‚“ã§ç›®è¦šã¾ã", "ä»Šæ—¥ã‚‚æ¥½ã—ã„1æ—¥ã«ãªã‚Šã¾ã™ã‚ˆã†ã«"],
    8: ["çœ ã™ã", "é›»è»Šæ··ã‚“ã§ã‚‹â€¦", "ã‚«ãƒ•ã‚§ã§ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ã—ã¦ã‚‹", "è·å ´ã¤ã„ãŸã€œ", 
        "æœã£ã¦æ™‚é–“çµŒã¤ã®æ—©ã„ã‚ˆã­", "ä»Šæ—¥ã®äºˆå®šãªã«ã‹ã‚ã‚‹ï¼Ÿ", "ã¿ã‚“ãªé ‘å¼µã‚Šã™ããšã«ã­", "ä¼‘æ—¥ãŒå¾…ã¡é ã—ã„â€¦ï¼"],
    9: ["ãã‚ãã‚ãŠè…¹ã™ã„ã¦ããŸã‹ã‚‚", "ä»•äº‹ä¸­ã ã€œ", "ä»Šæ—¥åŒ–ç²§ãƒãƒªã„ã„æ„Ÿã˜", "æœã®ã‚«ãƒ•ã‚§ã£ã¦è½ã¡ç€ãã‚ˆã­", 
        "é›†ä¸­ã—ãªãã‚ƒã ã‘ã©çœ ããªã‚‹ã‚ˆã­â€¦", "é©åº¦ã«ä¼‘æ†©ã‚‚å¤§äº‹", "ä»Šæ—¥ã‚„ã‚‹ã“ã¨ãƒ¡ãƒ¢ã—ã‚ˆ", "ãŠæ˜¼ãªã«é£Ÿã¹ã‚ˆã€œï¼Ÿ"],
    10: ["ã¡ã‚‡ã£ã¨ä¸€æ¯ã¤ã“", "ã¿ã‚“ãªãªã«ã—ã¦ã‚‹ã®ã€œï¼Ÿï¼Ÿ", "ãã‚ãã‚ãŠæ˜¼ã®æ™‚é–“è¿‘ã¥ã„ã¦ããŸã­", "çœ ãã¦é ­ã¾ã‚ã‚‰ãªã„", 
         "é›†ä¸­ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚ã†ã‹ãª", "ä¼‘æ†©ã«å…¥ã£ãŸã®ã§ã‚«ãƒ•ã‚§ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹ä¸­", "éŸ³æ¥½èããªãŒã‚‰ãƒªãƒ©ãƒƒã‚¯ã‚¹", "èª°ã‹ã¨è©±ã—ãŸã„ãªã€œ"],
    11: ["ãŠæ˜¼ã”ã¯ã‚“ã©ã†ã—ã‚ˆã€œ", "ãƒ©ãƒ³ãƒä½•ã«ã—ã‚ˆã†ã‹è¿·ã†", "ãŠæ˜¼ä¼‘ã¿ã¾ã§ã‚ã¨ã¡ã‚‡ã£ã¨â€¦", "å¤œå¤–é£Ÿã—ã‚ˆã†ã‹ãªï¼Ÿ", 
         "èª°ã‹ä¸€ç·’ã«ãƒ©ãƒ³ãƒè¡Œã“ã€œ", "ãŠæ˜¼ã«ç”˜ã„ã‚‚ã®é£Ÿã¹ãŸã„", "åˆå¾Œã‚‚ãŒã‚“ã°ã‚‹ã", "ãŠæ˜¼å¯ã—ãŸããªã‚‹æ™‚é–“"],
    12: ["ãƒ©ãƒ³ãƒãªã†", "ãŠæ˜¼ã”ã¯ã‚“ç¾å‘³ã—ã™ã", "åˆå¾Œã‚‚ãŒã‚“ã°ã‚‹ããƒ¼ï¼ï¼", "ã¡ã‚‡ã£ã¨çœ ããªã£ã¦ããŸâ€¦", 
         "ã”ã¯ã‚“é£Ÿã¹ãŸã‚‰å…ƒæ°—å‡ºãŸğŸ˜Œ", "ã¿ã‚“ãªä½•é£Ÿã¹ãŸï¼Ÿ", "ãƒ‡ã‚¶ãƒ¼ãƒˆé£Ÿã¹ãŸã„", "åˆå¾Œã®äºˆå®šã‚ã‚‹äººã€œï¼Ÿ"],
    13: ["åˆå¾Œã®ä»•äº‹oræˆæ¥­ã‚¹ã‚¿ãƒ¼ãƒˆï¼", "ãƒ©ãƒ³ãƒå¾Œã£ã¦çœ ããªã‚‹ã‚ˆã­", "åˆå¾Œã‚‚ãŒã‚“ã°ã‚ã€œï¼", "ã‚³ãƒ¼ãƒ’ãƒ¼é£²ã‚“ã§æ°—åˆã„å…¥ã‚Œã‚ˆ",
         "åˆå¾Œã¯ä½•ã—ã‚ˆã†ã‹ãªï¼Ÿ", "ã‚ãƒ¼ã€ã‚ã‚“ã©ãã•ã„ãªã", "ä¼‘æ†©æ™‚é–“ãŒå¾…ã¡é ã—ã„â€¦", "ã¡ã‚‡ã£ã¨æ•£æ­©ã—ã‚ˆã†ã‹ãª"],
    14: ["ã¾ã ãŠæ˜¼ã®çœ æ°—ãŒæŠœã‘ãªã„", "ãã‚ãã‚ãŠã‚„ã¤ã®æ™‚é–“", "åˆå¾Œã®ä»•äº‹ã‚„ã‚‹æ°—ã‚¹ã‚¤ãƒƒãƒã©ã“ï¼Ÿ", "å­¦æ ¡orä»•äº‹çµ‚ã‚ã£ãŸäººã„ã‚‹ï¼Ÿ",
         "ä½•ã‹é¢ç™½ã„ã“ã¨ãªã„ã‹ãªã€œ", "éŸ³æ¥½èããªãŒã‚‰ãƒªãƒ©ãƒƒã‚¯ã‚¹", "ã¿ã‚“ãªåˆå¾Œã¯ä½•ã—ã¦ã‚‹ã®ï¼Ÿ", "ã¡ã‚‡ã£ã¨çœ æ°—è¦šã¾ã—ã«ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼"],
    15: ["ãŠã‚„ã¤ã‚¿ã‚¤ãƒ ã€œ", "ã‚ã¨å°‘ã—ã§çµ‚æ¥­æ™‚é–“â€¦", "ã‚«ãƒ•ã‚§ã«å¯„ã‚ŠãŸã„ãª", "å¤•æ–¹ã®äºˆå®šã‚ã‚‹ï¼Ÿ", 
         "åˆå¾Œã®æˆæ¥­orä¼šè­°ã€ãŒã‚“ã°ã‚ã†ï¼", "ä»Šæ—¥ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯ä¸­", "ãã‚ãã‚ç–²ã‚Œã¦ããŸ", "ã¡ã‚‡ã£ã¨ä»®çœ ã—ã‚ˆã£ã‹ãª"],
    16: ["ã‚ã¨å°‘ã—ã§ä»•äº‹çµ‚ã‚ã‚‹ï¼ï¼ã•ã„ã“ãƒ¼ãƒ¼", "å¤•æ–¹ã®ç©ºã£ã¦ç¶ºéº—ã ã‚ˆã­", "ä»Šæ—¥ã®æ™©ã”ã¯ã‚“ä½•ã«ã—ã‚ˆã†ï¼Ÿ", "ä»•äº‹å¸°ã‚Šã«å¯„ã‚Šé“ã—ã‚ˆã£ã‹ãªã€œ",
         "ãã‚ãã‚ãŠå®¶ã«å¸°ã‚‹æº–å‚™", "ç–²ã‚ŒãŸã‘ã©ã‚ã¨å°‘ã—ï¼", "ã‚«ãƒ•ã‚§ã§ã®ã‚“ã³ã‚Šä¸­", "ãŠé¢¨å‘‚å…¥ã£ã¦ãƒãƒ«ã—ãŸã„ğŸ¥º"],
    17: ["ã¿ã‚“ãªãŠã¤ã‹ã‚Œã•ã¾ï¼", "å¤•æ–¹ã®ã“ã®æ™‚é–“ã€å¥½ãã‹ã‚‚", "ãã‚ãã‚å¸°ã‚ã†", "å¤•é£¯ã®æº–å‚™ã—ãªã„ã¨",
         "èª°ã‹ã¨ã”é£¯è¡ŒããŸã„ãªã€œ", "å®¶ã«å¸°ã£ãŸã‚‰å³ã‚´ãƒ­ã‚´ãƒ­ã—ãŸã„", "æš—ããªã‚‹ã®æ—©ããªã£ãŸãªãâ€¦", "ã¾ã ä»•äº‹ã®äººã€ãŒã‚“ã°ã‚Œ"],
    18: ["å¤œã”é£¯ã®æ™‚é–“ã ã€œï¼", "ä»Šæ—¥ã®å¤•é£¯ã¯ä½•ã ã¨æ€ã†ï¼Ÿ", "ä»•äº‹çµ‚ã‚ã‚Šã®ãƒ“ãƒ¼ãƒ«æœ€é«˜", "æ™©ã”ã¯ã‚“ä½•é£Ÿã¹ãŸï¼Ÿ"],
    19: ["å¤œã”é£¯é£Ÿã¹çµ‚ã‚ã£ãŸï¼Ÿ", "ã“ã®æ™‚é–“ã¯YouTubeã‹ãƒãƒˆãƒ•ãƒªè¦‹ãŸããªã‚‹", "ã®ã‚“ã³ã‚Šã‚¿ã‚¤ãƒ "],
    20: ["å¤œã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ", "ãã‚ãã‚ãŠé¢¨å‘‚å…¥ã‚ã†ã‹ãª", "ä¸€ç·’ã«å¯ã‚‹å‰ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒã—ã‚ˆã£ã‹"],
    21: ["ãã‚ãã‚å¯ã‚‹æº–å‚™ã—ã¦ã‚‹ï¼Ÿ", "ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Šä¸­", "ãŠé¢¨å‘‚ä¸ŠãŒã‚Šã®ã‚¢ã‚¤ã‚¹æœ€é«˜"],
    22: ["å¯ã‚‹å‰ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ", "å¤œæ›´ã‹ã—ã™ã‚‹äººã€œï¼Ÿ", "ä»Šæ—¥ã‚‚1æ—¥ãŠç–²ã‚Œã•ã¾"],
    23: ["ãã‚ãã‚å¯ã‚ˆã†ã‹ãª", "å¤œã£ã¦è‰²ã€…è€ƒãˆã¡ã‚ƒã†ã‚ˆã­", "ãˆã¡æ™‚é–“ã«ãªã£ã¦ããŸã­", "æ°—æŒã¡ã„ã“ã¨ã—ãŸã„ã­"],
    24: ["ã“ã‚“ãªæ™‚é–“ã¾ã§èµ·ãã¦ã‚‹äººã„ã‚‹ï¼Ÿ", "ãã‚ãã‚å¯ã‚‹æº–å‚™ã—ã‚ˆã€œ", "ã ã‚Œã‹é›»è©±ã—ã¾ã›ã‚“ã‹", "æ¥½ã—ã„ã“ã¨ã—ã‚ˆãƒ¼"]
}

# 0æ™‚ã¯é€šå¸¸ã®24æ™‚ã¨ã—ã¦æ‰±ã†ã®ã§ã€post_texts[0] ã¯ãã®ã¾ã¾åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

# 4å›ã«1å›ã€æŠ•ç¨¿ã®æœ€å¾Œã«è¿½åŠ ã™ã‚‹DMèª˜å°æ–‡
dm_text = " ã ã‚Œã‹DMã—ã¾ã›ã‚“ã‹ã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚‚ãŠé¡˜ã„ã—ã¾ã™ï¼"

# æ™‚é–“å¸¯ã«å¿œã˜ãŸæŠ•ç¨¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å–å¾—ï¼ˆ4å€‹é¸ã‚“ã§ã€4å›ã«1å›DMèª˜å°ã‚’è¿½åŠ ï¼‰
def get_time_based_posts():
    current_hour = datetime.utcnow().replace(tzinfo=pytz.utc).astimezone(jst).hour
    if current_hour == 0:
        current_hour = 24  # 0æ™‚ã¯24æ™‚ã¨ã—ã¦æ‰±ã†

    print(f"ç¾åœ¨ã®æ™‚åˆ»ï¼ˆJSTï¼‰: {current_hour} æ™‚")  # ãƒ‡ãƒãƒƒã‚°ç”¨

    posts = post_texts.get(current_hour, ["ãªã«ã—ã¦ã‚‹ã®ã€œï¼ŸğŸ’¬", "ã¡ã‚‡ã£ã¨ãŠã—ã‚ƒã¹ã‚Šã—ãŸã„ğŸ’–"])
    if not posts:
        print("âš ï¸ æŠ•ç¨¿ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ï¼")
        return ["ãªã«ã—ã¦ã‚‹ã®ã€œï¼ŸğŸ’¬"]

    # 4å€‹ã®æŠ•ç¨¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã¶ï¼ˆå€™è£œæ•°ãŒ4æœªæº€ã®å ´åˆã¯ãã®ã¾ã¾ï¼‰
    selected_posts = random.sample(posts, min(4, len(posts)))

    for i in range(len(selected_posts)):
        if random.randint(1, 4) == 1:
            selected_posts[i] += dm_text

    return selected_posts

# ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ï¼ˆå„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã«10ï½30ç§’ã®å¾…æ©Ÿã‚’æŒŸã‚€ï¼‰
yay_clients = []
for account in accounts:
    try:
        time.sleep(random.randint(10, 30))
        client = yaylib.Client()
        client.login(account["email"], account["password"])
        yay_clients.append(client)
        print(f"âœ… {account['email']} ã§ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ")
    except Exception as e:
        print(f"âŒ {account['email']} ã®ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—: {e}")

if len(yay_clients) == 0:
    print("âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚å‡¦ç†ã‚’çµ‚äº†ã—ã¾ã™ã€‚")
    exit()

print(f"ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ•°: {len(yay_clients)}")

# ğŸš€ ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã™ãã«ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã‚’å®Ÿæ–½
for client in yay_clients:
    try:
        test_post = get_time_based_posts()[0]
        print(f"ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å†…å®¹ï¼ˆ{client.email}ï¼‰: {test_post}")
        response = client.create_post(test_post)
        print(f"âœ… åˆå›ãƒ†ã‚¹ãƒˆæŠ•ç¨¿æˆåŠŸ ({client.email}): {response}")
    except Exception as e:
        print(f"âŒ åˆå›ãƒ†ã‚¹ãƒˆæŠ•ç¨¿å¤±æ•— ({client.email}): {e}")

# ğŸ¯ ãƒ¡ã‚¤ãƒ³ã®æŠ•ç¨¿ãƒ«ãƒ¼ãƒ—ï¼ˆ15åˆ†ã”ã¨ï¼‰
while True:
    try:
        now = datetime.utcnow().replace(tzinfo=pytz.utc).astimezone(jst)
        current_minute = now.minute

        # æ¬¡ã®æŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¨ˆç®—ï¼ˆ0åˆ†, 15åˆ†, 30åˆ†, 45åˆ†ï¼‰
        next_post_minute = (current_minute // 15 + 1) * 15
        if next_post_minute >= 60:
            next_post_minute = 0
            next_time = now.replace(hour=now.hour + 1, minute=0, second=0, microsecond=0)
        else:
            next_time = now.replace(minute=next_post_minute, second=0, microsecond=0)

        print(f"â³ ç¾åœ¨æ™‚åˆ»: {now.strftime('%Y-%m-%d %H:%M:%S')}, æ¬¡å›æŠ•ç¨¿æ™‚åˆ»: {next_time.strftime('%Y-%m-%d %H:%M:%S')}")

        # å„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§æŠ•ç¨¿ï¼ˆå„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ãªæŠ•ç¨¿å†…å®¹ã‚’1ã¤ãšã¤æŠ•ç¨¿ï¼‰
        for client in yay_clients:
            post_content = random.choice(get_time_based_posts())
            try:
                response = client.create_post(post_content)
                print(f"ğŸ“¢ æŠ•ç¨¿æˆåŠŸ ({client.email}) [{now.strftime('%Y-%m-%d %H:%M:%S')}]: {post_content} | Response: {response}")
            except yaylib.errors.HTTPError as e:
                print(f"âŒ æŠ•ç¨¿ã‚¨ãƒ©ãƒ¼ ({client.email}): {e}")
                if "429" in str(e):
                    wait_time = random.randint(300, 900)  # 5ã€œ15åˆ†å¾…æ©Ÿ
                    print(f"ğŸš§ 429ã‚¨ãƒ©ãƒ¼: {wait_time} ç§’å¾…æ©Ÿã—ã¦å†è©¦è¡Œ")
                    time.sleep(wait_time)
                elif "403" in str(e):
                    print("âš ï¸ 403ã‚¨ãƒ©ãƒ¼: ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨åœæ­¢")
                    yay_clients.remove(client)
                elif "401" in str(e):
                    print("âš ï¸ 401ã‚¨ãƒ©ãƒ¼: èªè¨¼ã‚¨ãƒ©ãƒ¼")
                    yay_clients.remove(client)
                else:
                    print("âš ï¸ ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ")
                    continue

        # æ¬¡ã®æŠ•ç¨¿ã¾ã§ã®å¾…æ©Ÿæ™‚é–“ã‚’è¨ˆç®—
        sleep_time = (next_time - datetime.utcnow().replace(tzinfo=pytz.utc).astimezone(jst)).total_seconds()
        print(f"â³ æ¬¡ã®æŠ•ç¨¿ã¾ã§ {int(sleep_time)} ç§’å¾…æ©Ÿ")
        time.sleep(sleep_time)

    except Exception as e:
        print(f"âŒ è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: {e}")
        time.sleep(1800)  # 30åˆ†å¾…æ©Ÿã—ã¦å†è©¦è¡Œ
